var Settings={homeScroll:function(){$(".nav").css("position","fixed"),$(".main").css("paddingTop","89px"),$(".nav-tabs").html($(".home-menu").html()).css("text-align","left")},notiScroll:function(){var e=$("#side"),t=e.width(),a=1===$(".small-tips").closest(".module").length?109+$(".small-tips").closest(".module").height():89;$(".side.fn-none").height(e.height()),$(window).scroll(function(){$(window).scrollTop()>a?(e.css({position:"fixed",width:t+"px",top:0,right:$(".wrapper").css("margin-right")}),$(".side.fn-none").show(),$(".small-tips").closest(".module").hide()):(e.removeAttr("style"),$(".side.fn-none").hide(),$(".small-tips").closest(".module").show())})},initHljs:function(){return 0!==$("pre code").length&&void $.ajax({method:"GET",url:Label.servePath+"/js/lib/highlight.js-9.6.0/highlight.pack.js",dataType:"script"}).done(function(){$("pre code").each(function(e,t){hljs.highlightBlock(t)})})},preview:function(e){"block"===$("#homeSidePanel").css("display")?($("#homeSidePanel").hide(),$(e).text(Label.previewLabel)):($("#homeSidePanel").show(),$("#userNicknameDom").text($("#userNickname").val()),$("#userTagsDom").text($("#userTags").val()),$("#userURLDom").text($("#userURL").val()).attr("href",$("#userURL").val()),$("#userIntroDom").text($("#userIntro").val()),$(e).text(Label.unPreviewLabel))},initUploadAvatar:function(e,t,a){var r="";""===e.qiniuUploadToken?$("#"+e.id).fileupload({acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:parseInt(e.maxSize),multipart:!0,pasteZone:null,dropZone:null,url:Label.servePath+"/upload",add:function(e,t){if(r=t.files[0].type.split("/")[1],window.File&&window.FileReader&&window.FileList&&window.Blob){var a=new FileReader;a.readAsArrayBuffer(t.files[0]),a.onload=function(e){var a=new Uint8Array(e.target.result.slice(0,11)),r=isImage(a);return r?e.target.result.byteLength>1048576?void alert("This image is too large (max 1M)"):void t.submit():void alert("Image only~")}}else t.submit()},formData:function(e){var t=e.serializeArray();return t},submit:function(e,t){},done:function(e,a){var r=a.result.key;return r?void t(a):void alert("Upload error")},fail:function(e,t){alert("Upload error: "+t.errorThrown)}}).on("fileuploadprocessalways",function(e,t){var a=t.files[t.index];t.files.error&&a.error&&alert(a.error)}):$("#"+e.id).fileupload({acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:parseInt(e.maxSize),multipart:!0,pasteZone:null,dropZone:null,url:"https://up.qbox.me/",add:function(e,t){if(r=t.files[0].type.split("/")[1],window.File&&window.FileReader&&window.FileList&&window.Blob){var a=new FileReader;a.readAsArrayBuffer(t.files[0]),a.onload=function(e){var a=new Uint8Array(e.target.result.slice(0,11)),r=isImage(a);return r?e.target.result.byteLength>1048576?void alert("This image is too large (max 1M)"):void t.submit():void alert("Image only~")}}else t.submit()},formData:function(t){var a=t.serializeArray();return a.push({name:"token",value:e.qiniuUploadToken}),a.push({name:"key",value:"avatar/"+e.userId+"_"+(new Date).getTime()+"."+r}),console.log(a),a},submit:function(e,t){},done:function(e,t){var r=t.result.key;return r?void a(t):void alert("Upload error")},fail:function(e,t){alert("Upload error: "+t.errorThrown)}}).on("fileuploadprocessalways",function(e,t){var a=t.files[t.index];t.files.error&&a.error&&alert(a.error)})},exportPosts:function(){$.ajax({url:Label.servePath+"/export/posts",type:"POST",cache:!1,success:function(e,t){return e.sc?void window.open(e.url):void alert("TBD: V, tip display it....")}})},changeGeoStatus:function(e){var t={userGeoStatus:$("#geoStatus").val()};$.ajax({url:Label.servePath+"/settings/geo/status",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),success:function(e,t){console.log(e)}})},pointTransfer:function(e){if(Validate.goValidate({target:$("#pointTransferTip"),data:[{target:$("#pointTransferUserName"),type:"string",max:256,msg:Label.invalidUserNameLabel},{target:$("#pointTransferAmount"),type:"string",max:50,msg:Label.amountNotEmpty}]})){var t={userName:$("#pointTransferUserName").val(),amount:$("#pointTransferAmount").val()};$.ajax({url:Label.servePath+"/point/transfer",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),beforeSend:function(){$("#pointTransferTip").removeClass("succ").removeClass("error").html("")},error:function(e,t,a){alert(a)},success:function(e,t){e.sc?$("#pointTransferTip").addClass("succ").removeClass("error").html("<ul><li>"+Label.transferSuccLabel+"</li></ul>"):$("#pointTransferTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#pointTransferTip").show(),setTimeout(function(){$("#pointTransferTip").hide()},2e3)}})}},pointBuyInvitecode:function(e){var t={};$.ajax({url:Label.servePath+"/point/buy-invitecode",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),beforeSend:function(){$("#pointBuyInvitecodeTip").removeClass("succ").removeClass("error").html("")},error:function(e,t,a){alert(a)},success:function(e,t){e.sc?$(".list ul").prepend('<li class="content-reset"><code>'+e.msg.split(" ")[0]+"</code>"+e.msg.substr(16)+"</li>"):$("#pointBuyInvitecodeTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#pointBuyInvitecodeTip").show()}})},queryInvitecode:function(e){var t={invitecode:$("#invitecode").val()};$.ajax({url:Label.servePath+"/invitecode/state",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),beforeSend:function(){$("#invitecodeStateTip").removeClass("succ").removeClass("error").html("")},error:function(e,t,a){alert(a)},success:function(e,t){switch(e.sc){case-1:case 0:case 2:$("#invitecodeStateTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>");break;case 1:$("#invitecodeStateTip").addClass("succ").removeClass("error").html("<ul><li>"+e.msg+"</li></ul>");break;default:$("#invitecodeStateTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>")}S,$("#invitecodeStateTip").show()}})},update:function(e,t){var a={};switch(e){case"profiles":a=this._validateProfiles();break;case"sync/b3":a=this._validateSyncB3();break;case"password":a=this._validatePassword();break;case"privacy":a={userArticleStatus:$("#userArticleStatus").prop("checked"),userCommentStatus:$("#userCommentStatus").prop("checked"),userFollowingUserStatus:$("#userFollowingUserStatus").prop("checked"),userFollowingTagStatus:$("#userFollowingTagStatus").prop("checked"),userFollowingArticleStatus:$("#userFollowingArticleStatus").prop("checked"),userWatchingArticleStatus:$("#userWatchingArticleStatus").prop("checked"),userFollowerStatus:$("#userFollowerStatus").prop("checked"),userPointStatus:$("#userPointStatus").prop("checked"),userOnlineStatus:$("#userOnlineStatus").prop("checked"),userJoinPointRank:$("#joinPointRank").prop("checked"),userJoinUsedPointRank:$("#joinUsedPointRank").prop("checked"),userUAStatus:$("#userUAStatus").prop("checked"),userTimelineStatus:$("#userTimelineStatus").prop("checked"),userForgeLinkStatus:$("#userForgeLinkStatus").prop("checked")};break;case"function":a={userListPageSize:$("#userListPageSize").val(),userCommentViewMode:$("#userCommentViewMode").val(),userAvatarViewMode:$("#userAvatarViewMode").val(),userNotifyStatus:$("#userNotifyStatus").prop("checked"),userSubMailStatus:$("#userSubMailStatus").prop("checked"),userKeyboardShortcutsStatus:$("#userKeyboardShortcutsStatus").prop("checked")};break;case"emotionList":a=this._validateEmotionList();break;case"i18n":a={userLanguage:$("#userLanguage").val(),userTimezone:$("#userTimezone").val()};break;default:console.log("update settings has no type")}return!!a&&void $.ajax({url:Label.servePath+"/settings/"+e,type:"POST",headers:{csrfToken:t},cache:!1,data:JSON.stringify(a),beforeSend:function(){$("#"+e.replace(/\//g,"")+"Tip").removeClass("succ").removeClass("error").html("")},error:function(e,t,a){alert(a)},success:function(t,r){if(t.sc){if($("#"+e.replace(/\//g,"")+"Tip").addClass("succ").removeClass("error").html("<ul><li>"+Label.updateSuccLabel+"</li></ul>").show(),"profiles"===e)return $("#userNicknameDom").text(a.userNickname),$("#userTagsDom").text(a.userTags),$("#userURLDom").text(a.userURL).attr("href",a.userURL),void $("#userIntroDom").text(a.userIntro)}else $("#"+e.replace(/\//g,"")+"Tip").addClass("error").removeClass("succ").html("<ul><li>"+t.msg+"</li></ul>");$("#"+e.replace(/\//g,"")+"Tip").show(),setTimeout(function(){$("#"+e.replace(/\//g,"")+"Tip").hide(),"i18n"===e&&window.location.reload()},5e3)}})},updateAvatar:function(e){var t={userAvatarURL:$("#avatarURL").data("imageurl")};$.ajax({url:Label.servePath+"/settings/avatar",type:"POST",headers:{csrfToken:e},cache:!1,data:JSON.stringify(t),beforeSend:function(){},error:function(e,t,a){alert(a)},success:function(e,a){e.sc&&$("#avatarURLDom, .user-nav .avatar-small").attr("style","background-image:url("+t.userAvatarURL+")")}})},_validateProfiles:function(){return!!Validate.goValidate({target:$("#profilesTip"),data:[{target:$("#userNickname"),type:"string",min:0,max:20,msg:Label.invalidUserNicknameLabel},{target:$("#userTags"),type:"string",min:0,max:255,msg:Label.tagsErrorLabel},{target:$("#userURL"),type:"string",min:0,max:255,msg:Label.invalidUserURLLabel},{target:$("#userIntro"),type:"string",min:0,max:255,msg:Label.invalidUserIntroLabel}]})&&{userNickname:$("#userNickname").val().replace(/(^\s*)|(\s*$)/g,""),userTags:$("#userTags").val().replace(/(^\s*)|(\s*$)/g,""),userURL:$("#userURL").val().replace(/(^\s*)|(\s*$)/g,""),userIntro:$("#userIntro").val().replace(/(^\s*)|(\s*$)/g,"")}},_validateSyncB3:function(){return!!Validate.goValidate({target:$("#syncb3Tip"),data:[{target:$("#soloKey"),type:"string",max:20,msg:Label.invalidUserB3KeyLabel},{target:$("#soloPostURL"),type:"url",msg:Label.invalidUserB3ClientURLLabel},{target:$("#soloUpdateURL"),type:"url",msg:Label.invalidUserB3ClientURLLabel},{target:$("#soloCmtURL"),type:"url",msg:Label.invalidUserB3ClientURLLabel}]})&&{userB3Key:$("#soloKey").val().replace(/(^\s*)|(\s*$)/g,""),userB3ClientAddArticleURL:$("#soloPostURL").val().replace(/(^\s*)|(\s*$)/g,""),userB3ClientUpdateArticleURL:$("#soloUpdateURL").val().replace(/(^\s*)|(\s*$)/g,""),userB3ClientAddCommentURL:$("#soloCmtURL").val().replace(/(^\s*)|(\s*$)/g,""),syncWithSymphonyClient:$("#syncWithSymphonyClient").prop("checked")}},_validatePassword:function(){var e=$("#pwdOld").val(),t=$("#pwdNew").val();if(Validate.goValidate({target:$("#passwordTip"),data:[{target:$("#pwdOld"),type:"password",msg:Label.invalidPasswordLabel},{target:$("#pwdNew"),type:"password",msg:Label.invalidPasswordLabel},{target:$("#pwdRepeat"),type:"password",oranginal:$("#pwdNew"),msg:Label.confirmPwdErrorLabel}]})){if(t!==$("#pwdRepeat").val())return!1;var a={};return a.userPassword=calcMD5(e),a.userNewPassword=calcMD5(t),a}return!1},_validateEmotionList:function(){return{emotions:$("#emotionList").val()}},makeAllNotificationsRead:function(){$.ajax({url:Label.servePath+"/notification/all-read",type:"GET",cache:!1,success:function(e,t){e.sc&&window.location.reload()}})},initFunction:function(){$("#emojiGrid img").click(function(){var e=$(this).attr("alt");$("#emotionList").val().indexOf(e)===-1&&(""!==$("#emotionList").val()?$("#emotionList").val($("#emotionList").val()+","+e):$("#emotionList").val(e))})}};